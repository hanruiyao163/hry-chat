"""
Mock LLM æœåŠ¡
ç”¨äº UI å¼€å‘æµ‹è¯•ï¼Œè¿”å›å›ºå®šçš„ Markdown å†…å®¹
"""
import asyncio
import random
from typing import AsyncGenerator


# Mock å“åº”åˆ—è¡¨ï¼ŒåŒ…å«å„ç§ Markdown æ ¼å¼ç”¨äºæµ‹è¯•æ¸²æŸ“
MOCK_RESPONSES = [
    """## è¿™æ˜¯ä¸€ä¸ªæµ‹è¯•å›å¤

è¿™æ˜¯ä¸€æ®µåŒ…å«**ç²—ä½“**å’Œ*æ–œä½“*çš„æ–‡æœ¬ï¼Œè¿˜æœ‰`è¡Œå†…ä»£ç `ã€‚

æ ¹æ®æ–‡æ¡£[^1]ï¼Œè¿™é‡Œæœ‰ä¸€ä¸ªå¼•ç”¨æ ‡æ³¨ã€‚å¦ä¸€ä¸ªæ¥æº[[æŠ€æœ¯æŠ¥å‘Š]]ä¹Ÿæåˆ°äº†ç›¸å…³å†…å®¹ã€‚

### ä»£ç ç¤ºä¾‹

```python
def hello_world():
    \"\"\"æ‰“å°é—®å€™è¯­\"\"\"
    print("Hello, World!")
    return True
```

### åˆ—è¡¨å±•ç¤º

- ç¬¬ä¸€é¡¹
- ç¬¬äºŒé¡¹
  - åµŒå¥—é¡¹ A
  - åµŒå¥—é¡¹ B
- ç¬¬ä¸‰é¡¹

### æœ‰åºåˆ—è¡¨

1. æ­¥éª¤ä¸€
2. æ­¥éª¤äºŒ
3. æ­¥éª¤ä¸‰

> è¿™æ˜¯ä¸€æ®µå¼•ç”¨æ–‡æœ¬ï¼Œå¯ä»¥ç”¨æ¥å±•ç¤ºé‡è¦ä¿¡æ¯ã€‚

| è¡¨å¤´1 | è¡¨å¤´2 | è¡¨å¤´3 |
|-------|-------|-------|
| æ•°æ®1 | æ•°æ®2 | æ•°æ®3 |
| æ•°æ®4 | æ•°æ®5 | æ•°æ®6 |

å¸Œæœ›è¿™ä¸ªå›å¤å¯¹ä½ æœ‰å¸®åŠ©ï¼
""",
    """## æŠ€æœ¯åˆ†ææŠ¥å‘Š

æ ¹æ®æ‚¨çš„é—®é¢˜ï¼Œæˆ‘æ¥è¯¦ç»†åˆ†æä¸€ä¸‹ï¼š

### 1. èƒŒæ™¯ä»‹ç»

è¿™æ˜¯ä¸€ä¸ªå…³äº[^1]äººå·¥æ™ºèƒ½æŠ€æœ¯çš„åˆ†æã€‚æ ¹æ®[[æœ€æ–°ç ”ç©¶]]ï¼Œæˆ‘ä»¬å‘ç°äº†ä»¥ä¸‹å‡ ç‚¹ï¼š

### 2. æ ¸å¿ƒè¦ç‚¹

**è¦ç‚¹ä¸€ï¼š** æ€§èƒ½æå‡æ˜¾è‘—
- å“åº”é€Ÿåº¦æå‡ 50%
- å†…å­˜å ç”¨é™ä½ 30%

**è¦ç‚¹äºŒï¼š** å…¼å®¹æ€§è‰¯å¥½
```javascript
// ç¤ºä¾‹ä»£ç 
const config = {
  enabled: true,
  timeout: 3000
};
```

### 3. ç»“è®º

ç»¼ä¸Šæ‰€è¿°ï¼Œè¿™é¡¹æŠ€æœ¯å€¼å¾—å…³æ³¨[^2]ã€‚

---

*ä»¥ä¸Šåˆ†æä»…ä¾›å‚è€ƒ*
""",
    """ä½ å¥½ï¼æˆ‘æ˜¯ AI åŠ©æ‰‹ã€‚

è®©æˆ‘ç”¨ç®€å•çš„æ–¹å¼å›ç­”ä½ çš„é—®é¢˜ï¼š

1. **é¦–å…ˆ**ï¼Œç¡®è®¤ä½ çš„éœ€æ±‚
2. **å…¶æ¬¡**ï¼Œåˆ†æå¯è¡Œæ–¹æ¡ˆ
3. **æœ€å**ï¼Œç»™å‡ºå»ºè®®

> ğŸ’¡ å°æç¤ºï¼šä¿æŒè€å¿ƒï¼Œå¾ªåºæ¸è¿›ã€‚

å¦‚æœéœ€è¦æ›´å¤šå¸®åŠ©ï¼Œéšæ—¶å‘Šè¯‰æˆ‘ï¼
""",
]

# æµ‹è¯•ç”¨çš„å¼•ç”¨æ•°æ®
MOCK_CITATIONS = {
    "1": {
        "id": "1",
        "title": "å®˜æ–¹æ–‡æ¡£ - å¿«é€Ÿå…¥é—¨",
        "content": "æœ¬æ–‡æ¡£ä»‹ç»äº†å¦‚ä½•å¿«é€Ÿå¼€å§‹ä½¿ç”¨æˆ‘ä»¬çš„äº§å“ã€‚é¦–å…ˆï¼Œæ‚¨éœ€è¦å®‰è£…å¿…è¦çš„ä¾èµ–...",
        "source": "docs.example.com"
    },
    "2": {
        "id": "2", 
        "title": "æ€§èƒ½ä¼˜åŒ–æŒ‡å—",
        "content": "é€šè¿‡ä»¥ä¸‹æ–¹æ³•å¯ä»¥æ˜¾è‘—æå‡ç³»ç»Ÿæ€§èƒ½ï¼š1. ä½¿ç”¨ç¼“å­˜ 2. ä¼˜åŒ–æŸ¥è¯¢ 3. å¼‚æ­¥å¤„ç†...",
        "source": "wiki.example.com"
    },
    "æŠ€æœ¯æŠ¥å‘Š": {
        "id": "tech-report",
        "title": "2024å¹´åº¦æŠ€æœ¯æŠ¥å‘Š",
        "content": "æœ¬æŠ¥å‘Šæ€»ç»“äº†è¿‡å»ä¸€å¹´çš„æŠ€æœ¯å‘å±•è¶‹åŠ¿ï¼ŒåŒ…æ‹¬AIã€äº‘è®¡ç®—ã€è¾¹ç¼˜è®¡ç®—ç­‰é¢†åŸŸçš„æœ€æ–°è¿›å±•...",
        "source": "research.example.com"
    },
    "æœ€æ–°ç ”ç©¶": {
        "id": "latest-research",
        "title": "æœ€æ–°ç ”ç©¶æˆæœ",
        "content": "ç ”ç©¶å›¢é˜Ÿåœ¨è‡ªç„¶è¯­è¨€å¤„ç†é¢†åŸŸå–å¾—é‡å¤§çªç ´ï¼Œæ–°æ¨¡å‹åœ¨å¤šé¡¹åŸºå‡†æµ‹è¯•ä¸­è¾¾åˆ°é¢†å…ˆæ°´å¹³...",
        "source": "arxiv.org"
    }
}


class MockLLMService:
    """Mock LLM æœåŠ¡ç±»"""
    
    def __init__(self):
        self.response_index = 0
    
    async def stream(self, messages: list[dict]) -> AsyncGenerator[str, None]:
        """
        æ¨¡æ‹Ÿæµå¼è¿”å›å†…å®¹
        
        Args:
            messages: æ¶ˆæ¯å†å²ï¼ˆåœ¨Mockæ¨¡å¼ä¸‹å¿½ç•¥ï¼‰
            
        Yields:
            å†…å®¹ç‰‡æ®µ
        """
        # é€‰æ‹©ä¸€ä¸ªå“åº”ï¼ˆè½®è¯¢æˆ–éšæœºï¼‰
        response = MOCK_RESPONSES[self.response_index % len(MOCK_RESPONSES)]
        self.response_index += 1
        
        # æ¨¡æ‹Ÿæ‰“å­—æœºæ•ˆæœï¼Œé€å­—ç¬¦æˆ–é€è¯è¿”å›
        words = response.split(' ')
        for i, word in enumerate(words):
            # æ·»åŠ ç©ºæ ¼ï¼ˆé™¤äº†ç¬¬ä¸€ä¸ªè¯ï¼‰
            if i > 0:
                yield ' '
            yield word
            # éšæœºå»¶è¿Ÿæ¨¡æ‹ŸçœŸå®æ‰“å­—æ•ˆæœ
            await asyncio.sleep(random.uniform(0.02, 0.08))
    
    def get_citations(self) -> dict:
        """è·å–å¼•ç”¨æ•°æ®"""
        return MOCK_CITATIONS


# å•ä¾‹å®ä¾‹
mock_llm_service = MockLLMService()
